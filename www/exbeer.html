<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html>
  <head>
    <title>
      Capture Photo
    </title>
    <link rel="stylesheet" type="text/css" charset="utf-8" href="css/exbeer.css" />
    <link rel="stylesheet" type="text/css" charset="utf-8" href="css/style.css" />
    <script type="text/javascript" charset="utf-8" src="js/cordova-1.7.0rc1.js"></script>
<!--    <script type="text/javascript" charset="utf-8" src="cordova-1.7.0rc1.js"></script> -->

    <script type="text/javascript" charset="utf-8" src="js/config.js"></script>
    <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>
    <script type="text/javascript" charset="utf-8" src="js/cloudmine.js"></script>
    <script type="text/javascript" charset="utf-8" src="js/camera.js"></script>
    <script type="text/javascript" charset="utf-8" src="js/users.js"></script>
    <script type="text/javascript" charset="utf-8" src="js/exbeer.js"></script>
    <script>
    $(function() {

      var exb = new ExBeer();
      var users = new Users();

      $('img').click(function() {
        try {
          // capturePhoto(function(filepath) {
          pickPhoto(function(filepath) {
            // alert('success');
            $("#photo").attr('src', filepath);
            exb.postPhoto(filepath, function(err, uid) {
              console.log('postPhoto success uid:' + uid);
              $("#uid").val(uid);
            });
            // alert(two);
          }, function(fail, three) {
            console.log('fail');
            console.log(fail);
            console.log(three);
          });
        } catch(err) {
          console.log('Error: '+err.toString());
        }

      });
      $('#form').submit(function(evt) {
        evt.preventDefault();
        var words = [];
        for (var i=0; i < 3; i++) words[i] = $('form #word' + i).val();
        var user = users.getUser();
        console.error("DEBUG: user:" + JSON.stringify(user));
        var vals = {
          uid: $("#uid").val(),
          words: words,
          beer: {
            name: $("#beername").val(),
            brewery: $("#brewery").val()
          },
          user: {
            name: users.getUser().name,
            picture: "https://graph.facebook.com/" + users.getUser().fbid + '/picture'
          }
        };

        console.log(JSON.stringify(vals));
        exb.postExBeerience(vals, function(err, exBeerience) {
          console.error("DEBUG: err", err);
          console.error("DEBUG: exBeerience", exBeerience);
          window.location = 'feed.html';
        });
        return false;
      })
    })
    </script>
  </head>
  <body>
    <h1>Share your ExBeerience!</h1>
    <img id="photo">
    <form id='form'>
      <div class='words'>
        <h2>Describe it:</h2>
        <input type='hidden' name='uid' id='uid' />
        <input type='text' class='word' id='word0' placeholder='Purple.'/>
        <input type='text' class='word' id='word1' placeholder='Tall.'/>
        <input type='text' class='word' id='word2' placeholder='Insightful.'/>
      </div>
      <div class='clear'></div>
      <div class='beer'>
        <input type='text' class='beerinput' id='brewery' placeholder='Brewery...'/>
        <input type='text' class='beerinput' id='beername' placeholder='Beer Name...'/>
      </div>
      <input type='submit' value='Post Your ExBeerience!'>
    </form>
    <p>
<!--      <button onclick="capturePhoto();">Capture Photo</button><br>
      <button onclick="capturePhotoEdit();">Capture Editable Photo</button><br>
      <button onclick="getPhoto(pictureSource.PHOTOLIBRARY);">From Photo Library</button><br>
      <button onclick="getPhoto(pictureSource.SAVEDPHOTOALBUM);">From Photo Album</button><br>
      <img style="display:none;width:60px;height:60px;" id="smallImage" src="" name="smallImage"> <img style="display:none;" id="largeImage" src="" name="largeImage"> -->
    </p>
  </body>
</html>
